k8s_namespace: "{{ mynamespace | default('hygieia')}}"
filter_tags: unpriv

openshift_cluster_content:
  - object: Admin-level setup
    content:
    - name: Configure Projects
      template: "{{ inventory_dir }}/../.openshift/templates/projects.yml"
      params_from_vars:
        NAMESPACE: "{{ k8s_namespace }}"
        DISPLAY_NAME: Hygieia Deployment
      action: create
      tags:
        - priv
        - all
    - name: Apply policy objects
      template: "{{ inventory_dir }}/../.openshift/policy/"
      namespace: "{{ k8s_namespace }}"
      tags:
        - priv
        - all
  - object: Builds
    content:
    - name: Java base image
      template: "{{ inventory_dir }}/../.openshift/templates/build-base-image.yml"
      tags:
        - unpriv
        - all
    - name: API
      template: "{{ inventory_dir }}/../.openshift/templates/build-api.yml"
      tags:
        - unpriv
        - all
    - name: Audit API
      template: "{{ inventory_dir }}/../.openshift/templates/build-apiaudit.yml"
      tags:
        - unpriv
        - all
  - object: Deployments
    content:
    - name: API
      template: "{{ inventory_dir }}/../.openshift/templates/deployment-api.yml"
      tags:
        - unpriv
        - all
    - name: Audit API
      template: "{{ inventory_dir }}/../.openshift/templates/deployment-apiaudit.yml"
      tags:
        - unpriv
        - all
